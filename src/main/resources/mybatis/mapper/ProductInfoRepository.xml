<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.nginx.auth.repository.ProductInfoRepository">

    <resultMap id="BaseResultMap" type="org.nginx.auth.model.PlanInfo">
        <id column="id" property="id"/>
        <result column="product_name" property="productName"/>
        <result column="product_desc" property="productDesc"/>
        <result column="route_list_text" property="routeListText"/>
        <result column="product_price" property="productPrice"/>
        <result column="product_time_unit" property="productTimeUnit"/>
        <result column="product_time_value" property="productTimeValue"/>
        <result column="product_stock" property="productStock"/>
        <result column="in_use" property="inUse"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        `id`, `product_name`, `product_desc`, `route_list_text`, `product_price`, `product_time_unit`, `product_time_value`,
        `product_stock`, `in_use`, `create_time`, `update_time`
    </sql>

<!--    <select id="selectByIdList" parameterType="java.util.List" resultMap="BaseResultMap">-->
<!--        SELECT-->
<!--        <include refid="Base_Column_List"/>-->
<!--        FROM product_info-->
<!--        WHERE id IN-->
<!--        <foreach collection="ids" item="id" open="(" separator="," close=")">-->
<!--            #{id}-->
<!--        </foreach>-->
<!--    </select>-->

<!--    <select id="selectAllInUse" resultMap="BaseResultMap">-->
<!--        SELECT-->
<!--        <include refid="Base_Column_List"/>-->
<!--        FROM product_info-->
<!--        WHERE in_use = 1-->
<!--        ORDER BY create_time DESC-->
<!--    </select>-->

<!--    <select id="selectById" parameterType="java.lang.Long" resultMap="BaseResultMap">-->
<!--        SELECT-->
<!--        <include refid="Base_Column_List"/>-->
<!--        FROM product_info-->
<!--        WHERE id = #{id}-->
<!--    </select>-->

    <update id="reduceStock" parameterType="org.nginx.auth.model.PlanInfo">
        UPDATE product_info
        SET product_stock = product_stock - 1
        WHERE id = #{id}
        AND product_stock > 0
    </update>

</mapper>
